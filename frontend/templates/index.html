<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Análisis Bancario</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .loading {
            display: none; /* Ocultar por defecto */
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="dashboard max-w-7xl mx-auto p-6">
        <div class="header bg-white p-6 rounded-lg shadow-md mb-6">
            <h1 class="text-2xl font-bold">Dashboard de Análisis Bancario</h1>
            <p id="total-encuestas" class="text-gray-700">Cargando datos...</p>
        </div>

        <!-- Loader -->
        <div id="loader" class="loading fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="loader animate-spin rounded-full h-16 w-16 border-b-4 border-blue-400"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="card bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold">Precisión del Modelo</h2>
                <div id="precision" class="text-3xl text-blue-600 mt-2">--</div>
            </div>
            <div class="card bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold">Factores Importantes</h2>
                <div class="chart-container relative" style="height: 300px;">
                    <canvas id="factoresChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold">Perfiles de Clientes</h2>
            <div id="perfiles" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                <!-- Los perfiles se cargarán dinámicamente -->
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="card bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold">Satisfacción General</h2>
                <div class="chart-container relative" style="height: 300px;">
                    <canvas id="satisfaccionChart"></canvas>
                </div>
            </div>
            <div class="card bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold">Calidad del Servicio</h2>
                <div class="chart-container relative" style="height: 300px;">
                    <canvas id="calidadChart"></canvas>
                </div>
            </div>
        </div>
    </div>


    <footer class="bg-white rounded-lg shadow m-4 dark:bg-gray-800">
        <div class="w-full mx-auto max-w-screen-xl p-4 md:flex md:items-center md:justify-between">
          <span class="text-sm text-gray-500 sm:text-center dark:text-gray-400">© 2023 <a href="#" class="hover:underline">Prediccion bancario</a>. All Rights Reserved.
        </span>
        <ul class="flex flex-wrap items-center mt-3 text-sm font-medium text-gray-500 dark:text-gray-400 sm:mt-0 gap-4">
            <li>
                <a href="#" class="hover:underline me-4 md:me-6">< Desarrollado por Stiven Colorado/> </a>
            </li>
            <li>
                <a href="#" class="hover:underline me-4 md:me-6">3218956487</a>
            </li>
            <li>
                <a href="#" class="hover:underline">Desarrollado con IA </a>
            </li>
        </ul>
        </div>
    </footer>
    
    <script>
        // Función para cargar los datos
        async function cargarDatos() {
            // Mostrar el loader
            document.getElementById('loader').style.display = 'flex';

            try {
                const response = await fetch('/predecir/');
                const datos = await response.json();
                actualizarDashboard(datos);
            } catch (error) {
                console.error('Error al cargar los datos:', error);
            } finally {
                // Ocultar el loader
                document.getElementById('loader').style.display = 'none';
            }
        }

        // Función para actualizar el dashboard
        function actualizarDashboard(datos) {
            // Actualizar total de encuestas
            document.getElementById('total-encuestas').textContent = 
                `Total de encuestas analizadas: ${datos.estadisticas.total_encuestas}`;

            // Actualizar precisión del modelo
            document.getElementById('precision').textContent = 
                `${(datos.predicciones.precision_modelo * 100).toFixed(1)}%`;

            // Actualizar gráfico de factores importantes
            const factoresCtx = document.getElementById('factoresChart').getContext('2d');
            new Chart(factoresCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(datos.predicciones.factores_importantes),
                    datasets: [{
                        label: 'Importancia de Factores',
                        data: Object.values(datos.predicciones.factores_importantes),
                        backgroundColor: '#3b82f6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Actualizar perfiles
            const perfilesContainer = document.getElementById('perfiles');
            perfilesContainer.innerHTML = '';
            
            Object.entries(datos.perfiles).forEach(([perfil, info]) => {
                const perfilCard = document.createElement('div');
                perfilCard.className = 'bg-gray-50 p-4 rounded-lg shadow-sm';
                perfilCard.innerHTML = `
                    <h3 class="font-semibold text-lg">${perfil.replace('_', ' ').toUpperCase()}</h3>
                    <div class="profile-info mt-2 text-sm">
                        <p><strong>Tamaño:</strong> ${info.tamaño}</p>
                        <p><strong>Edad común:</strong> ${info.edad_comun}</p>
                        <p><strong>Frecuencia:</strong> ${info.frecuencia_uso_tipica}</p>
                    </div>
                `;
                perfilesContainer.appendChild(perfilCard);
            });

            // Gráfico de satisfacción
            const satisfaccionCtx = document.getElementById('satisfaccionChart').getContext('2d');
            new Chart(satisfaccionCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(datos.satisfaccion.general),
                    datasets: [{
                        data: Object.values(datos.satisfaccion.general),
                        backgroundColor: [
                            '#3b82f6',
                            '#10b981',
                            '#f59e0b',
                            '#ef4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Gráfico de calidad de servicio
            const calidadCtx = document.getElementById('calidadChart').getContext('2d');
            new Chart(calidadCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(datos.satisfaccion.calidad_servicio),
                    datasets: [{
                        label: 'Calidad del Servicio',
                        data: Object.values(datos.satisfaccion.calidad_servicio),
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Cargar datos cuando se carga la página
        document.addEventListener('DOMContentLoaded', cargarDatos);
    </script>
</body>
</html>
